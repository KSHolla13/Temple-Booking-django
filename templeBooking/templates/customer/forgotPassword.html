{%extends 'siteflow/index.html'%}
{% load static %}
{%block title%}Temple{%endblock%}
{%block content %}
{%include 'siteflow/header.html'%}


        <section class="login-section">
            <div class="container m-0 p-0 mx-auto">
                <div class="row no-gutters shadow-lg">
                    <div class="col-md-5 p-1 m-0 d-none d-md-block ">
                        <img src="{% static '/siteflow/img/Mask Group 3.png'%}" class="w-100 h-100 Login-img">
                    </div>
                    <div class="col-md-7 bg-white p-5 mt-lg-5 mt-md-2 mt-sm-2
                        mt-0">
                        <h3 class="login-header pb-3"><span class="pop-outin ">Forgot  </span><span class="pop-outin ">Password</span></h3>
                        <p class="entermail email-heading">Enter the associated email</p>
                        <p class="entermail otp-heading" hidden>Enter the OTP</p>
                        <p class="entermail change-heading"  hidden>Change the password</p>
                        <div class="form-style">
                        {% if messages   %}
                        {% for message in messages %}
                        <div><p class="backendmes" >{{message}}</p></div>
                        {%endfor%}
                        {%endif%}
                            <form id="forgotform" method="post">
                                {% csrf_token %}
                                <div class="form-group login pb-3 mt-3">
                                    <input
                                        type="email"
                                        placeholder="Email"
                                        class="form-control"
                                        name="email"
                                        id="email"
                                        required>
                                </div>
                                <div class="form-group pb-3 mt-3">
                                    <input
                                        type="number"
                                        placeholder="otp"
                                        class="form-control"
                                        id="otp"
                                        name="otp"
                                        required hidden>
                                </div>
                                <div class="form-group password pb-3 mt-3">
                                    <input
                                        type="password"
                                        placeholder="Password"
                                        class="form-control"
                                        name="password1"
                                        id="password1"
                                        required hidden>
                                </div>
                                <div class="form-group password pb-3 mt-3">
                                    <input
                                        type="password"
                                        placeholder="Password"
                                        class="form-control"
                                        id="password2"
                                        name="password2"
                                        required hidden>
                                </div>
                                <div class="pb-2 mt-1">
                                    <button type="submit" class="btn sendotp sign-in glow-on-hover
                                        w-100 mt-2">Send OTP</button>
                                </div>
                                <div class="pb-2 mt-1">
                                    <button type="submit" class="btn verifyotp sign-in glow-on-hover
                                        w-100 mt-2" hidden>verify otp</button>
                                </div>
                                <div class="pb-2 mt-1">
                                    <button type="submit" class="btn changepassword sign-in glow-on-hover
                                        w-100 mt-2" hidden>submit</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <script src="{%static '/siteflow/js/jquery-3.6.0.min.js'%}"></script>
        <script src="{%static '/siteflow/js/validate.min.js'%}" ></script>
        <script>
        
            $(".sendotp").click(function(){
              
                var email=$("#email").val()
                if (email===""){
                    $('#email').css({
                        'border' : '1px solid red',
                    });
                }
                else{
                    $.ajax({
                        type: "POST",
                        dataType: "json",
                        data: {
                        
                        "email":email,
                        "action":"sendotp",
                        'csrfmiddlewaretoken':"{{ csrf_token }}",
                        },
                        success: function(resp){ 
                            if (resp["message"]){
                                $(".verifyotp").prop("hidden",false)
                                $("#otp").prop("hidden",false)
                                $("#email").prop("hidden",true)
                                $(".sendotp").prop("hidden",true)
                                $('#email').css({
                                    'border' : '1px solid black',
                                });
            
                            }
                            else{
                              //  $('#email').css({
                              //      'border' : '1px solid black',
                              //  });
                                alert(resp["res"])
                            }
                        }
                    });
                }
            })
        
        
            $(".verifyotp").click(function(){
                var email=$("#email").val()
                var otp=$("#otp").val()
        
                if (otp===""){
                    $('#otp').css({
                        'border' : '1px solid red',
                    });
                }
                else{
                    $.ajax({
                        type: "POST",
                        dataType: "json",
                        data: {
                        "otp":otp,
                        "email":email,
                        "action":"verifyotp",
                        'csrfmiddlewaretoken':"{{ csrf_token }}",
                        },
                        success: function(resp){ 
                            if (resp["message"]){
                                $(".verifyotp").prop("hidden",true)
                                $("#otp").prop("hidden",true)
                                $("#password1").prop("hidden",false)
                                $("#password2").prop("hidden",false)
                                $(".changepassword").prop("hidden",false)
                                $('#otpfield').css({
                                    'border' : '1px solid black',
                                });
                          alert(resp["res"])
                            }
                            else{
                            alert(resp["res"])
                            }
                        }
                    });
                }
             
            })

            $(".changepassword").click(function(){
                var passowrd1=$("#password1").val()
                var password2=$("password2").val()
                if (password2===""){
                    $('#password2').css({
                        'border' : '1px solid red',
                    });
            }
            else{
                $.ajax({
                    type:"post",
                    dataType:"json",
                    data:{
                        "password1":password1,
                        "password2":password2,
                        "action":"changepassword",
                        'csrfmiddlewaretoken':"{{ csrf_token }}",
                    },
                    success: function(resp){
                        if (resp["message"]){
                            window.location.replace("{% url 'login' %}")
                        }                        
                    },
                    error: function(){
                        alert("form submission failed")
                    }

                })
            }
        })
        
            // $(document).ready(function(){
            //     $('#forgotform').submit(function(e){
            //         e.preventDefault();
            //         $.ajax({
            //             //url: "get_data.php",
            //             type: "POST",
            //             data: $(this).serialize(),
            //             success: function(resp){
            //                 if(resp["message"]){
                               
            //                         window.location.replace( "{% url 'login' %}")
        
                                
            //                 }
                        
            //             },
            //             error: function(){
            //                 alert("Form submission failed!");
            //             }
            //         });
            //     });
            // });
        </script>    
       {% endblock %}
